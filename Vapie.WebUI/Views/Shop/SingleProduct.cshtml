@model ShopViewModel
@{
    ViewData["Title"] = "SingleProduct";
}
<div class="page-header breadcrumb-wrap">
    <div class="container">
        <div class="breadcrumb">
            <a class="me-1" asp-action="Index" asp-controller="Home"><i class="fa-solid fa-house me-1"></i>Home</a>
            <i class="fa-solid fa-basket-shopping"></i> Shop
        </div>
    </div>
</div>
<div class="col-12 bg-white py-3 my-3">
    <div class="row">
        <div class="col-lg-5 col-md-12 mb-3">
            <div class="col-12 mb-3">
                
                <div class="img-large border" style="background-image: url('/uploads/images/@Model.Product.Images.FirstOrDefault(i=>i.IsMain==true).ImagePath')"></div>
            </div>
            <div class="col-12">
                <div class="row">
                    @foreach (var item in Model.Product.Images)
                    {
                        <div class="col-sm-2 col-3">
                            <div class="img-small border" style="background-image: url('/uploads/images/@item.ImagePath')" data-src="/uploads/images/@item.ImagePath"></div>
                        </div>
                    }
                </div>
            </div>
        </div>
        <div class="col-lg-5 col-md-9">
            <div class="col-12 product-name large">
                @Model.Product.Name
                <small>By <a href="#">@Model.Product.Brand.Name</a></small>
            </div>
            <div class="col-12 px-0">
                <hr>
            </div>
            <div class="col-12">
                <ul>
                    <li>Capacity: @Model.Product.Capacity</li>
                    <li>Flavor: @Model.Product.Flavor</li>
                    <li>Nicotine Strength: @Model.Product.NicotineStrength</li>
                    <li>Size: @Model.Product.Size</li>
                    <li>Category: @Model.Product.Category.Name</li>
                </ul>
            </div>
        </div>
        <div class="col-lg-2 col-md-3 text-center">
            <div class="col-12 sidebar h-100">
                <div class="row">
                    <div class="col-12">
                        <span class="detail-price">
                            @Model.Product.Price ₼
                        </span>
                    </div>
                    <div class="col-xl-5 col-md-9 col-sm-3 col-5 mx-auto mt-3">
                        <div class="mb-3">
                            <label for="qty">Quantity</label>
                            <input type="number" id="qty" min="1" value="1" class="form-control" required>
                        </div>
                    </div>
                    <div class="col-12 mt-3">
                        <button class="btn btn-outline-dark" data-item-id="@Model.Product.Id" onclick="addToCart(event)" type="button">
                            <i class="fas fa-cart-plus me-2"></i>Add to cart
                        </button>
                    </div>
                    <div class="col-12 mt-3">
                        <button class="btn btn-outline-secondary btn-sm" type="button"><i class="fas fa-heart me-2"></i>Add to wishlist</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-12 mb-3 py-3 bg-white text-justify">
    <div class="row">
        <div class="col-md-7">
            <div class="col-12">
                <div class="row">
                    <div class="col-12 text-uppercase">
                        <h2><u>Details</u></h2>
                    </div>
                    <div class="col-12" id="details">
                        @Model.Product.Description
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="col-12 px-md-4 sidebar h-100">
                <div class="row">
                    <div class="col-12 mt-md-0 mt-3 text-uppercase">
                        <h2><u>Ratings & Reviews</u></h2>
                    </div>
                    <div class="col-12">
                        <div class="row">
                            <div class="col-sm-4 text-center">
                                <div class="row">
                                    <div class="col-12 average-rating">
                                        4.1
                                    </div>
                                    <div class="col-12">
                                        of 100 reviews
                                    </div>
                                </div>
                            </div>
                            <div class="col">
                                <ul class="rating-list mt-3">
                                    <li>
                                        <div class="progress">
                                            <div class="progress-bar bg-dark" role="progressbar" style="width: 45%;" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100">45%</div>
                                        </div>
                                        <div class="rating-progress-label">
                                            5<i class="fas fa-star ms-1"></i>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="progress">
                                            <div class="progress-bar bg-dark" role="progressbar" style="width: 30%;" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">30%</div>
                                        </div>
                                        <div class="rating-progress-label">
                                            4<i class="fas fa-star ms-1"></i>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="progress">
                                            <div class="progress-bar bg-dark" role="progressbar" style="width: 15%;" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100">15%</div>
                                        </div>
                                        <div class="rating-progress-label">
                                            3<i class="fas fa-star ms-1"></i>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="progress">
                                            <div class="progress-bar bg-dark" role="progressbar" style="width: 7%;" aria-valuenow="7" aria-valuemin="0" aria-valuemax="100">7%</div>
                                        </div>
                                        <div class="rating-progress-label">
                                            2<i class="fas fa-star ms-1"></i>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="progress">
                                            <div class="progress-bar bg-dark" role="progressbar" style="width: 3%;" aria-valuenow="3" aria-valuemin="3" aria-valuemax="100">3%</div>
                                        </div>
                                        <div class="rating-progress-label">
                                            1<i class="fas fa-star ms-1"></i>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 px-md-3 px-0">
                        <hr>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <h4>Add Review</h4>
                    </div>
                    <div class="col-12">
                        <form>
                            <div class="mb-3">
                                <textarea class="form-control" placeholder="Give your review"></textarea>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex ratings justify-content-end flex-row-reverse">
                                    <input type="radio" value="5" name="rating" id="rating-5"><label for="rating-5"></label>
                                    <input type="radio" value="4" name="rating" id="rating-4"><label for="rating-4"></label>
                                    <input type="radio" value="3" name="rating" id="rating-3"><label for="rating-3"></label>
                                    <input type="radio" value="2" name="rating" id="rating-2"><label for="rating-2"></label>
                                    <input type="radio" value="1" name="rating" id="rating-1" checked><label for="rating-1"></label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <button class="btn btn-outline-dark">Add Review</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 px-md-3 px-0">
                        <hr>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="col-12 text-justify py-2 px-3 mb-3 bg-gray">
                            <div class="row">
                                <div class="col-12">
                                    <strong class="me-2">Steve Rogers</strong>
                                    <small>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="far fa-star"></i>
                                        <i class="far fa-star"></i>
                                    </small>
                                </div>
                                <div class="col-12">
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce ut ullamcorper quam, non congue odio.
                                    <br>
                                    Fusce ligula augue, faucibus sed neque non, auctor rhoncus enim. Sed nec molestie turpis. Nullam accumsan porttitor rutrum. Curabitur eleifend venenatis volutpat.
                                    <br>
                                    Aenean faucibus posuere vehicula.
                                </div>
                                <div class="col-12">
                                    <small>
                                        <i class="fas fa-clock me-2"></i>5 hours ago
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 text-justify py-2 px-3 mb-3 bg-gray">
                            <div class="row">
                                <div class="col-12">
                                    <strong class="me-2">Bucky Barns</strong>
                                    <small>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="far fa-star"></i>
                                        <i class="far fa-star"></i>
                                        <i class="far fa-star"></i>
                                    </small>
                                </div>
                                <div class="col-12">
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce ut ullamcorper quam, non congue odio.
                                    <br>
                                    Aenean faucibus posuere vehicula.
                                </div>
                                <div class="col-12">
                                    <small>
                                        <i class="fas fa-clock me-2"></i>5 hours ago
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-12">
    <div class="row">
        <div class="col-12 py-3">
            <div class="row">
                <div class="col-12 text-center text-uppercase">
                    <h2>Similar Products</h2>
                </div>
            </div>
            <div class="row">
                @foreach (var item in Model.Products)
                {
                    var imagePath = item.Images.FirstOrDefault(i => i.IsMain == true).ImagePath;
                    <div class="col-lg-3 col-sm-6 my-3">
                        <div class="col-12 bg-white text-center h-100 product-item">
                            <div class="row h-100">
                                <div class="col-12 p-0 mb-3">
                                    <a asp-action="singleproduct" asp-route-id="@item.Id" asp-route-categoryId="@item.CategoryId">
                                        <img src="~/uploads/images/@imagePath" class="img-fluid">
                                    </a>
                                </div>
                                <div class="col-12 mb-3">
                                    <a asp-action="singleproduct" asp-route-id="@item.Id" asp-route-categoryId="@item.CategoryId" class="product-name">@item.Name</a>
                                </div>
                                <div class="col-12 mb-3">
                                    <span class="product-price">
                                        @item.Price ₼
                                    </span>
                                </div>
                                <div class="col-12 mb-3 align-self-end">
                                    <button data-item-id="@item.Id" onclick="addToCart(event)" class="btn btn-outline-dark" type="button"><i class="fas fa-cart-plus me-2"></i>Add to cart</button>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section js{
    <script>
        function addToCart(ev) {
            ev.preventDefault();
            ev.stopPropagation();
            let data = $(ev.currentTarget).data();
            addToBasket(data.itemId);

            console.log(readFromBasket())
        }
        function readFromBasket() {
            return ($.cookie('cards') || '').split(',');
        }
        function addToBasket(cardId) {
            let items = readFromBasket();
            let length = items.filter(item => item == cardId).length;
            if (length > 0) return;
            items.push(cardId);
            $.cookie('cards', items.toString(), { expires: 7, path: '/' });
        }

        function showCardCount() {
            let items = readFromBasket();
            $('#header-qty').html(items.length - 1);

        }
        showCardCount();

    </script>
}